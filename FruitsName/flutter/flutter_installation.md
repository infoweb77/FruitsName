# Интеграция библиотеки ZGRImSDK в мобильное приложение, основанное на фреймворке Flutter


## Интеграция в ручном режиме

* Убедиться в наличии всех необходимых файлов от ZGR.
    * `ZGRConfig.json` (файл конфигации)
    * `ZGRImSDK.xcframework` (динамическая универсальная библиотека)
    
* Открыть Xcode и установить фреймворк в приложение: 
    1. Перетянуть полученный от ZGR конфигурационный файл `ZGRConfig.json` в корневой каталог в иерархии файлов проекта (левая панель в `Xcode`)
    2. Активировать чек-бокс `Copy items if needed`
    3. Перетянуть файл `ZGRImSDK.xcframework` в каталог Frameworks (левая панель в `Xcode`). В случае, если в проекте отсутствует папка Frameworks, перетянуть файл `ZGRImSDK.xcframework` в раздел Frameworks, Libraries, and Embedded Content нв центральном экране основного таргета приложения.
    ![Изображение 1](./fl_4.png)
    4. Активировать чек-бокс `Copy items if needed`
    5. Перейти в основные настройки таргета приложения (первая вкладка), к разделу `Frameworks, Libraries and Embedded Content`, нажать "+"
    6. В открывшемся меню выбрать библиотеку `ZGRImSDK.xcframework`, нажать "Add"
    ![Изображение 2](./fl_12.png)
    7. Убедиться, что библиотека будет встроена в приложение посредством установки пункта `Embed & Sign`
    ![Изображение 3](./fl_5.png)


## Интеграция c помощью менеджера пакетов CocoaPods

1. Перетянуть полученный от ZGR конфигурационный файл `ZGRConfig.json` в  в иерархию файлов проекта (левая панель в `Xcode`)
2. Активировать чек-бокс `Copy items if needed`
3. Создать `podfile` и отредактировать таким образом, чтобы библиотека `ZGRImSDK.xcframework` устанавливалась и в основное 
приложение и в расширения.

    ![Пример podfile](./fl_11_1.png)
    
4. Выполнить команду `pod install`. Убедиться, что необходимые библиотеки интегрированы в проект.
    ![Изображение 4](./fl_11.png)
    
5. Перейти в основные настройки таргета приложения (первая вкладка), к разделу `Frameworks, Libraries and Embedded Content`, нажать "+"
6. В открывшемся меню выбрать библиотеку `ZGRImSDK.xcframework`, нажать "Add"
    ![Изображение 5](./fl_12.png)
7. Убедиться, что `pod` c библиотекой будет встроен в приложение посредством установки пункта `Embed & Sign`
    ![Изображение 6](./fl_5.png)
    

## Создание и настройка расширений приложения

### Notification Service Extension
* Обязательно для корректной работы SDK.

Сервис, занимающийся в фоне отправкой отчетов о прочтении.

* Создать расширение приложения (extension)
    1. Зайти в меню приложения и на левой панели в нижнем левом углу нажать "+"
    2. В списке расширений выбрать `Notification Service Extension`
    3. Ввести любое название, например:  `notification-service`
    3. Во всплывающем запросе на активацию новосозданной схемы выбрать "Cancel"

* Связать сервис уведомлений с библиотекой `ZGRImSDK.xcframework`
    1. Перейти в основные настройки таргета  `Notification Service Extension`, раздел `Frameworks, Libraries and Embedded Content`, нажать "+"
    2. В открывшемся меню выбрать  `ZGRImSDK.xcframework`, нажать "Add".
    3. Библиотека уже скопирована основным таргетом в бандл приложения, поэтому здесь мы выбираем `Do Not Embed`.
    

### Notification Content Extension

* Опционально. Не влияет на корректную работу SDK.

Сервис, занимающийся отображением расширенного медиаконтента в пуш-уведомлении.

* Создать расширение приложения (extension).
    1. Зайти в меню приложения и на левой панели в нижнем левом углу нажать "+"
    2. В списке расширений выбрать `Notification Content Extension`
    3. Ввести любое название, например:  `notification-content`
    3. Во всплывающем запросе на активацию новосозданной схемы выбрать "Cancel"

* Связать сервис уведомлений с библиотекой `ZGRImSDK.xcframework`
    1. Перейти в основные настройки таргета  `Notification Content Extension`, раздел `Frameworks, Libraries and Embedded Content`, нажать "+"
    2. В открывшемся меню выбрать  `ZGRImSDK.xcframework`, нажать "Add".
    3. Библиотека уже скопирована основным таргетом в бандл приложения, поэтому здесь мы выбираем `Do Not Embed`.
    

## Настройка App Group

* Данный шаг необходимо выполнить для возможности синхронизации конфигурации и локальной базы данных пушей между основным приложением и его расширениями. Если у вас возникнут трудности с этим шагом, то вам помогут приложенные к инструкции изображения `App_Group_*`.

* Добавить `Сapability` -> `App Group` в возможности вашего приложения.
    1. Перейти в настройки основного таргета вашего приложения.
    2. Перейти во вкладку `Signing & Capabilities`.
    3. Нажать кнопку `+ Capability`.
    4. Выбрать `App Groups`.
    5. В появившемся разделе `App Groups` нажать кнопку `+ (Создание новой группы)`.
    6. В окне `Add a new container` после `group.` ввести идентификатор вашего приложения (`bundle identifier`).
        - Пример: приложение имеет идентификатор `im.zgr.app`, в данное поле необходимо ввести строку `group.im.zgr.app`.
    ![Изображение окна ввода](./App_Group.png)
        
  
  #### Без изменений повторить шаги 1-6 для таргетов `Notification Service Extension` и `Notification Content Extension`.
    ![Изображение 7](./App_Group_1.png)
    ![Изображение 8](./App_Group_2.png)
    ![Изображение 9](./App_Group_3.png)
    
